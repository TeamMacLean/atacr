<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Dan MacLean" />

<meta name="date" content="2018-03-21" />

<title>Differentially accessible or expressed windows</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Differentially accessible or expressed windows</h1>
<h4 class="author"><em>Dan MacLean</em></h4>
<h4 class="date"><em>2018-03-21</em></h4>



<p>Finding windows that correspond to differentially expressed or accessible windows is possible with two related functions in <code>atacr</code> - <code>estimate_fdr()</code> which implements bootstrap <em>t</em>-tests, via the boot package and <code>estimate_bayes_factor()</code> which implements a Bayes factor ANOVA using the BayesFactor package. A tidy dataframe of results is returned in each case.</p>
<div id="bootstrap-t-tests" class="section level3">
<h3>Bootstrap <em>t</em>-tests</h3>
<p>For simple comparison of two treatments with bootstrap <em>t</em> tests, provide treatment ‘a’ and ‘b’ names and the number of bootstrap iterations (default is 10, which is fast for testing code, but useless analytically). You can set the threshold for marking as significant with <code>fdr_level</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> result &lt;-<span class="st"> </span><span class="kw">estimate_fdr</span>(normalized_counts,
              <span class="dt">treatment_a =</span>  <span class="st">&quot;treatment&quot;</span>,
              <span class="dt">treatment_b =</span> <span class="st">&quot;control&quot;</span>,
              <span class="dt">iterations =</span> <span class="dv">100000</span>,
              <span class="dt">fdr_level =</span> <span class="fl">0.01</span>)</code></pre></div>
<pre><code>##                  window         t p_value       fdr mean_count_a
## 1    synth_chrom:1-50:- -1.938336     0.1 0.2130435    5632.6667
## 2  synth_chrom:51-100:+ -1.218827     0.2 0.3062500    9758.6667
## 3 synth_chrom:101-150:-  4.107091     0.0 0.0000000     205.3333
## 4 synth_chrom:151-200:- -1.510404     0.2 0.3062500   15202.6667
## 5 synth_chrom:251-300:-  3.308530     0.0 0.0000000   39171.0000
## 6 synth_chrom:301-350:-  1.400435     0.3 0.3868421      62.0000
##   mean_count_b        sd_a         sd_b   log2_fc is_sig
## 1  15382.66667  6377.90407  5935.290164 -1.449416  FALSE
## 2  20613.66667  4435.08403 14774.507279 -1.078845  FALSE
## 3     83.66667    50.46121     9.291573  1.295243   TRUE
## 4  36699.33333 19444.72315 15152.091814 -1.271429  FALSE
## 5  15567.33333 12216.06745  1859.435488  1.331264   TRUE
## 6     12.33333    59.80803    14.011900  2.329705  FALSE</code></pre>
<p>The output has columns as follows:</p>
<ul>
<li><code>window</code> - the name of the window with data on this row</li>
<li><code>t</code> - the value of the <em>t</em> statistic for the first (non-bootstrap) iteration</li>
<li><code>p_value</code> - the computed <em>p</em> value for the window</li>
<li><code>fdr</code> - the false detection rate at this window</li>
<li><code>mean_count_a</code> - the mean count for treatment ‘a’</li>
<li><code>mean_count_b</code> - the mean count for treatment ‘b’</li>
<li><code>sd_a</code> - standard deviation for treatment ‘a’</li>
<li><code>sd_b</code> - standard deviation for treatment ‘b’</li>
<li><code>log2_fc</code> - log 2 of the ratio of the mean counts</li>
<li><code>is_sig</code> - flag showing whether window was significant according to the level set in the function with parameter <code>fdr_level</code></li>
</ul>
<p>To analyse all treatments against a common comparison at once you can use the wrapper function <code>estimate_fdr_multiclass()</code> which requires the name of the common comparison treatment</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">multi_result &lt;-<span class="st">  </span><span class="kw">estimate_fdr_multiclass</span>(normalized_counts,
              <span class="dt">common_control =</span> <span class="st">&quot;control&quot;</span>,
              <span class="dt">iterations =</span> <span class="dv">100000</span>,
              <span class="dt">fdr_level =</span> <span class="fl">0.01</span>)

<span class="kw">head</span>(multi_result)</code></pre></div>
<pre><code>##                  window         t p_value       fdr mean_count_a
## 1    synth_chrom:1-50:- -1.938336     0.0 0.0000000    5632.6667
## 2  synth_chrom:51-100:+ -1.218827     0.0 0.0000000    9758.6667
## 3 synth_chrom:101-150:-  4.107091     0.0 0.0000000     205.3333
## 4 synth_chrom:151-200:- -1.510404     0.1 0.1689655   15202.6667
## 5 synth_chrom:251-300:-  3.308530     0.0 0.0000000   39171.0000
## 6 synth_chrom:301-350:-  1.400435     0.1 0.1689655      62.0000
##   mean_count_b        sd_a         sd_b   log2_fc is_sig         a       b
## 1  15382.66667  6377.90407  5935.290164 -1.449416   TRUE treatment control
## 2  20613.66667  4435.08403 14774.507279 -1.078845   TRUE treatment control
## 3     83.66667    50.46121     9.291573  1.295243   TRUE treatment control
## 4  36699.33333 19444.72315 15152.091814 -1.271429  FALSE treatment control
## 5  15567.33333 12216.06745  1859.435488  1.331264   TRUE treatment control
## 6     12.33333    59.80803    14.011900  2.329705  FALSE treatment control</code></pre>
<p>The results here has two extra columns:</p>
<ul>
<li>a - the name of the treatment</li>
<li>b - the name of the common control</li>
</ul>
</div>
<div id="bayes-factor-analysis" class="section level3">
<h3>Bayes Factor Analysis</h3>
<p>A similar pair of functions is available for Bayes factor analysis. <code>estimate_bayes_factor()</code> for the two-way comparison. The <code>factor</code> argument sets the Bayes factor at which to mark the window as having different counts.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">result_bf &lt;-<span class="st">  </span><span class="kw">estimate_bayes_factor</span>(normalized_counts,
                           <span class="dt">treatment_a =</span>  <span class="st">&quot;treatment&quot;</span>,
                           <span class="dt">treatment_b =</span> <span class="st">&quot;control&quot;</span>,
                                <span class="dt">factor =</span> <span class="fl">2.0</span>)

<span class="kw">head</span>(result_bf)</code></pre></div>
<pre><code>##                  window bayes_factor is_sig mean_count_a mean_count_b
## 1    synth_chrom:1-50:-   0.20483396  FALSE    5632.6667  15382.66667
## 2  synth_chrom:51-100:+  -0.20139051  FALSE    9758.6667  20613.66667
## 3 synth_chrom:101-150:-   1.39100629  FALSE     205.3333     83.66667
## 4 synth_chrom:151-200:-  -0.04237361  FALSE   15202.6667  36699.33333
## 5 synth_chrom:251-300:-   0.98251046  FALSE   39171.0000  15567.33333
## 6 synth_chrom:301-350:-  -0.10371176  FALSE      62.0000     12.33333
##          sd_a         sd_b   log2_fc
## 1  6377.90407  5935.290164 -1.449416
## 2  4435.08403 14774.507279 -1.078845
## 3    50.46121     9.291573  1.295243
## 4 19444.72315 15152.091814 -1.271429
## 5 12216.06745  1859.435488  1.331264
## 6    59.80803    14.011900  2.329705</code></pre>
<p>Again, a <code>estimate_bayes_factor_multiclass()</code> function works for all comparisons to a common control.</p>
<p>The results data frame is similar to that from the Bootstrap <em>t</em> methods, with a <code>factor</code> column in place of the <code>t</code> and <code>fdr</code> columns.</p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
